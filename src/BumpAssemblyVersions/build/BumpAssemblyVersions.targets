<?xml version="1.0" encoding="utf-8"?>
<Project>

  <UsingTask AssemblyFile="..\BumpAssemblyVersions.dll" TaskName="Bav.BumpVersion" />

  <!-- ReSharper disable once UnknownProperty -->
  <Target Name="BavBeforeBuild" BeforeTargets="BeforeBuild" Condition="!Exists($(BavLockFilePath))">

    <ItemGroup>
      <FilesToBump Condition="Exists('Properties\AssemblyInfo.cs')" Include="Properties\AssemblyInfo.cs" />
    </ItemGroup>

    <!-- ReSharper disable UnknownItemGroup, ReSharper disable once UnknownTask -->
    <BumpVersion Configuration="$(Configuration)" Bumps="@(BumpVersionSpec)"
                 Files="@(FilesToBump)" ProjectFullPath="$(ProjectPath)">
      <Output TaskParameter="NewVersion" PropertyName="BumpVersionNewVersion" />
      <Output TaskParameter="NewAssemblyVersion" PropertyName="BumpVersionNewAssemblyVersion" />
      <Output TaskParameter="NewFileVersion" PropertyName="BumpVersionNewFileVersion" />
      <Output TaskParameter="NewInformationalVersion" PropertyName="BumpVersionNewInformationalVersion" />
      <Output TaskParameter="NewPackageVersion" PropertyName="BumpVersionNewPackageVersion" />
    </BumpVersion>

    <PropertyGroup>
      <Version Condition="$(BumpVersionNewVersion) != ''">$(BumpVersionNewVersion)</Version>
      <AssemblyVersion Condition="$(BumpVersionNewAssemblyVersion) != ''">$(BumpVersionNewAssemblyVersion)</AssemblyVersion>
      <FileVersion Condition="$(BumpVersionNewFileVersion) != ''">$(BumpVersionNewFileVersion)</FileVersion>
      <InformationalVersion Condition="$(BumpVersionNewInformationalVersion) != ''">$(BumpVersionNewInformationalVersion)</InformationalVersion>
      <PackageVersion Condition="$(BumpVersionNewPackageVersion) != ''">$(BumpVersionNewPackageVersion)</PackageVersion>
    </PropertyGroup>

  </Target>

  <PropertyGroup>
    <BumpAssemblyVersionsLoaded>true</BumpAssemblyVersionsLoaded>
  </PropertyGroup>

  <ItemGroup>
    <!-- TODO: TBD: it would be better to do this here, but does not seem to happen. So must be done at the CSPROJ level. --> 
    <BumpVersionSpec Update="@(BumpVersionSpec)" Visible="False" />
    <FilesToBump Update="@(FilesToBump)" Visible="False" />
  </ItemGroup>

</Project>
